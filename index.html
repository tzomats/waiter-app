<!DOCTYPE html>
<html lang="el">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Waiter</title>
    <style>
        :root {
            --primary: #4361ee;
            --secondary: #3f37c9;
            --success: #4cc9f0;
            --danger: #f72585;
            --warning: #f9c74f;
        }

        body {
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
            background: linear-gradient(135deg, #1e3a8a 0%, #3b82f6 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            color: #1f2937;
        }

        .container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 30px;
            border-radius: 24px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.2);
            width: 90%;
            max-width: 380px;
            text-align: center;
        }

        .table-info {
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--primary);
            font-weight: 800;
            margin-bottom: 5px;
        }

        h1 { font-size: 24px; margin-top: 0; color: #111827; }

        textarea {
            width: 100%;
            height: 100px;
            border: 2px solid #e5e7eb;
            border-radius: 16px;
            padding: 15px;
            font-size: 16px;
            margin: 15px 0;
            box-sizing: border-box;
            outline: none;
            transition: all 0.3s;
            background: #f9fafb;
        }

        textarea:focus { border-color: var(--primary); background: white; }

        .btn {
            width: 100%;
            padding: 16px;
            margin-bottom: 12px;
            border: none;
            border-radius: 16px;
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .btn-mic { background: var(--primary); color: white; box-shadow: 0 4px 15px rgba(67, 97, 238, 0.3); }
        .btn-send { background: #10b981; color: white; box-shadow: 0 4px 15px rgba(16, 185, 129, 0.3); }
        .btn-waiter { background: #f59e0b; color: white; margin-top: 10px; box-shadow: 0 4px 15px rgba(245, 158, 11, 0.3); }

        .btn:active { transform: scale(0.96); }

        .footer-text { font-size: 12px; color: #9ca3af; margin-top: 20px; }
    </style>
</head>
<body>

<div class="container" id="app">
    <div class="table-info">Î¤Î¡Î‘Î Î•Î–Î™ <span id="table-num">0</span></div>
    <h1>Î Î±ÏÎ±Î³Î³ÎµÎ»Î¯Î±</h1>

    <textarea id="order-text" placeholder="Î ÎµÎ¯Ï„Îµ Ï„Î·Î½ Ï€Î±ÏÎ±Î³Î³ÎµÎ»Î¯Î± ÏƒÎ±Ï‚..."></textarea>

    <button class="btn btn-mic" id="mic-btn" onclick="toggleMic()">
        <span id="mic-icon">ğŸ¤</span> <span id="mic-label">ÎÎµÎºÎ¹Î½Î®ÏƒÏ„Îµ Ï„Î·Î½ ÎŸÎ¼Î¹Î»Î¯Î±</span>
    </button>

    <button class="btn btn-send" onclick="sendOrder()">
        <span>ğŸš€</span> Î‘Ï€Î¿ÏƒÏ„Î¿Î»Î®
    </button>

    <div style="height: 1px; background: #eee; margin: 20px 0;"></div>

    <button class="btn btn-waiter" onclick="callWaiter()">
        <span>ğŸ””</span> ÎšÎ»Î®ÏƒÎ· Î£ÎµÏÎ²Î¹Ï„ÏŒÏÎ¿Ï…
    </button>

    <div class="footer-text">Powered by Smart Waiter API</div>
</div>

<script>
    const token = "8597389134:AAGpXgvvHgWg0SHhsQUiZF4Fsg0bq6XmoNA";
    const chatId = "8228642098";
    const urlParams = new URLSearchParams(window.location.search);
    const table = urlParams.get('table') || "Î†Î³Î½Ï‰ÏƒÏ„Î¿";
    document.getElementById('table-num').innerText = table;

    // --- Î¡Î¥Î˜ÎœÎ™Î£Î•Î™Î£ Î“Î•Î©Î•ÎÎ¤ÎŸÎ Î™Î£ÎœÎŸÎ¥ ---
    const STORE_LAT = 39.234732; // Î’Î¬Î»Îµ ÎµÎ´Ï Ï„Î¿ Latitude Ï„Î¿Ï… Î¼Î±Î³Î±Î¶Î¹Î¿Ï
    const STORE_LON = 20.601351; // Î’Î¬Î»Îµ ÎµÎ´Ï Ï„Î¿ Longitude Ï„Î¿Ï… Î¼Î±Î³Î±Î¶Î¹Î¿Ï
    const MAX_DISTANCE = 0.1;  // Î‘Ï€ÏŒÏƒÏ„Î±ÏƒÎ· Î±ÏƒÏ†Î±Î»ÎµÎ¯Î±Ï‚ (0.1 = 100 Î¼Î­Ï„ÏÎ±)

    let recognition;
    let isRecording = false;

    // Î£Ï…Î½Î¬ÏÏ„Î·ÏƒÎ· Ï…Ï€Î¿Î»Î¿Î³Î¹ÏƒÎ¼Î¿Ï Î±Ï€ÏŒÏƒÏ„Î±ÏƒÎ·Ï‚ (Haversine Formula)
    function checkLocation(callback) {
        if (!navigator.geolocation) {
            alert("ÎŸ Î³ÎµÏ‰ÎµÎ½Ï„Î¿Ï€Î¹ÏƒÎ¼ÏŒÏ‚ Î´ÎµÎ½ Ï…Ï€Î¿ÏƒÏ„Î·ÏÎ¯Î¶ÎµÏ„Î±Î¹. Î”Î¿ÎºÎ¹Î¼Î¬ÏƒÏ„Îµ Î¬Î»Î»Î¿Î½ browser.");
            return;
        }

        navigator.geolocation.getCurrentPosition((position) => {
            const R = 6371; 
            const dLat = (position.coords.latitude - STORE_LAT) * Math.PI / 180;
            const dLon = (position.coords.longitude - STORE_LON) * Math.PI / 180;
            const a = Math.sin(dLat / 2) * Math.sin(dLat / 2) +
                      Math.cos(STORE_LAT * Math.PI / 180) * Math.cos(position.coords.latitude * Math.PI / 180) *
                      Math.sin(dLon / 2) * Math.sin(dLon / 2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
            const distance = R * c;

            if (distance <= MAX_DISTANCE) {
                callback(); // Î‘Î½ ÎµÎ¯Î½Î±Î¹ ÎºÎ¿Î½Ï„Î¬, ÎµÎºÏ„Î­Î»ÎµÏƒÎµ Ï„Î·Î½ Î±Ï€Î¿ÏƒÏ„Î¿Î»Î®
            } else {
                alert("Î ÏÎ­Ï€ÎµÎ¹ Î½Î± Î²ÏÎ¯ÏƒÎºÎµÏƒÏ„Îµ ÏƒÏ„Î¿ ÎºÎ±Ï„Î¬ÏƒÏ„Î·Î¼Î± Î³Î¹Î± Î½Î± ÏƒÏ„ÎµÎ¯Î»ÎµÏ„Îµ Ï€Î±ÏÎ±Î³Î³ÎµÎ»Î¯Î±!");
            }
        }, () => {
            alert("Î Î±ÏÎ±ÎºÎ±Î»Ï ÎµÎ½ÎµÏÎ³Î¿Ï€Î¿Î¹Î®ÏƒÏ„Îµ Ï„Î·Î½ Ï„Î¿Ï€Î¿Î¸ÎµÏƒÎ¯Î± ÏƒÏ„Î¿ ÎºÎ¹Î½Î·Ï„ÏŒ ÏƒÎ±Ï‚ Î³Î¹Î± Î½Î± Ï€Î±ÏÎ±Î³Î³ÎµÎ¯Î»ÎµÏ„Îµ.");
        });
    }

    // --- ÎŸÎ™ Î”Î™ÎšÎ•Î£ Î£ÎŸÎ¥ Î£Î¥ÎÎ‘Î¡Î¤Î—Î£Î•Î™Î£ (Î§Î©Î¡Î™Î£ Î‘Î›Î›Î‘Î“Î•Î£ Î£Î¤Î— Î›ÎŸÎ“Î™ÎšÎ—) ---
    function toggleMic() {
        const SpeechRecognition = window.webkitSpeechRecognition || window.SpeechRecognition;
        if (!SpeechRecognition) return alert("ÎŸ browser Î´ÎµÎ½ Ï…Ï€Î¿ÏƒÏ„Î·ÏÎ¯Î¶ÎµÎ¹ Ï†Ï‰Î½Î®.");
        if (!isRecording) {
            recognition = new SpeechRecognition();
            recognition.lang = "el-GR";
            recognition.interimResults = true;
            recognition.continuous = true;
            recognition.onstart = () => { isRecording = true; updateMicUI(true); };
            recognition.onresult = (event) => {
                let text = "";
                for (let i = 0; i < event.results.length; i++) { text += event.results[i][0].transcript; }
                document.getElementById('order-text').value = text;
            };
            recognition.start();
        } else { stopMic(); }
    }

    function stopMic() {
        if (recognition) {
            recognition.stop();
            setTimeout(() => { 
                recognition.abort(); 
                recognition = null; 
                isRecording = false;
                updateMicUI(false);
            }, 300);
        }
    }

    function updateMicUI(recording) {
        const btn = document.getElementById('mic-btn');
        const label = document.getElementById('mic-label');
        const icon = document.getElementById('mic-icon');
        if (recording) {
            btn.style.background = "#f72585";
            label.innerText = "Î¤Î•Î›ÎŸÎ£ (Î Î±Ï„Î®ÏƒÏ„Îµ)";
            icon.innerText = "ğŸ›‘";
        } else {
            btn.style.background = "#4361ee";
            label.innerText = "ÎÎµÎºÎ¹Î½Î®ÏƒÏ„Îµ Ï„Î·Î½ ÎŸÎ¼Î¹Î»Î¯Î±";
            icon.innerText = "ğŸ¤";
        }
    }

    // Î•Î´Ï Ï€ÏÎ¿ÏƒÎ¸Î­Ï„Î¿Ï…Î¼Îµ Ï„Î¿ checkLocation Ï€ÏÎ¹Î½ Ï„Î·Î½ Î±Ï€Î¿ÏƒÏ„Î¿Î»Î®
    function callWaiter() { 
        checkLocation(() => {
            sendToTelegram(`ğŸ”” ÎšÎ›Î—Î£Î— Î£Î•Î¡Î’Î™Î¤ÎŸÎ¡ÎŸÎ¥\nğŸ“ Î¤ÏÎ±Ï€Î­Î¶Î¹: ${table}`, "ÎŸ ÏƒÎµÏÎ²Î¹Ï„ÏŒÏÎ¿Ï‚ ÎµÎ¹Î´Î¿Ï€Î¿Î¹Î®Î¸Î·ÎºÎµ!"); 
        });
    }

    function sendOrder() {
        const text = document.getElementById('order-text').value;
        if (!text) return alert("Î ÎµÎ¯Ï„Îµ ÎºÎ¬Ï„Î¹ Ï€ÏÏÏ„Î±!");
        checkLocation(() => {
            sendToTelegram(`ğŸ“ ÎÎ•Î‘ Î Î‘Î¡Î‘Î“Î“Î•Î›Î™Î‘\nğŸ“ Î¤ÏÎ±Ï€Î­Î¶Î¹: ${table}\nğŸ’¬: ${text}`, "Î— Ï€Î±ÏÎ±Î³Î³ÎµÎ»Î¯Î± ÎµÏƒÏ„Î¬Î»Î·!");
        });
    }

    function sendToTelegram(msg, successMsg) {
        fetch(`https://api.telegram.org/bot${token}/sendMessage?chat_id=${chatId}&text=${encodeURIComponent(msg)}`)
        .then(() => {
            document.getElementById('app').innerHTML = `
                <div style="padding:40px 0; text-align:center;">
                    <div style="font-size:60px; margin-bottom:20px;">âœ…</div>
                    <h2 style="margin:0;">${successMsg}</h2>
                    <p style="color:#666;">Î•Ï…Ï‡Î±ÏÎ¹ÏƒÏ„Î¿ÏÎ¼Îµ Ï€Î¿Î»Ï!</p>
                    <button class="btn" onclick="location.reload()" style="margin-top:20px; background:#4361ee; color:white; padding:10px 20px; border:none; border-radius:10px;">ÎÎ­Î± Î•Î½Î­ÏÎ³ÎµÎ¹Î±</button>
                </div>`;
        });
    }
</script>
</body>
</html>


